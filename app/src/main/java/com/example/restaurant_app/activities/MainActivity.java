package com.example.restaurant_app.activities;import android.Manifest;import android.content.Intent;import android.content.pm.PackageManager;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.Toast;import androidx.appcompat.app.AppCompatActivity;import androidx.core.app.ActivityCompat;import com.example.restaurant_app.adapters.SharedPreferencesAdapter;import com.example.restaurant_app.firestore.TableFirestoreManager;import com.example.restaurant_app.models.Table;import com.google.zxing.integration.android.IntentIntegrator;import com.google.zxing.integration.android.IntentResult;import static com.google.zxing.integration.android.IntentIntegrator.REQUEST_CODE;/** * * @author Simon Rothmann, Jonas Mitschke * @content activity for start */public class MainActivity extends AppCompatActivity {    private TableFirestoreManager tableManager;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        tableManager = TableFirestoreManager.newInstance();        // logout current user / reset current table        SharedPreferencesAdapter.setDefaults("currentUser", null, this);        SharedPreferencesAdapter.setDefaults("currentTable", null, this);        final Button btnScan = findViewById(R.id.ScanCodeButton);        btnScan.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                String permission = Manifest.permission.CAMERA;                int res = view.getContext().checkCallingOrSelfPermission(permission);                if (res == PackageManager.PERMISSION_GRANTED) {                    IntentIntegrator integrator = new IntentIntegrator(MainActivity.this);                    integrator.setDesiredBarcodeFormats(IntentIntegrator.QR_CODE);                    integrator.setPrompt(getResources().getString(R.string.message_scan));                    integrator.setCameraId(0);                    integrator.setOrientationLocked(false);                    integrator.setBeepEnabled(false);                    integrator.setBarcodeImageEnabled(false);                    integrator.initiateScan();                } else {                    requestPermission(Manifest.permission.CAMERA, 1);                    Toast toast = Toast.makeText(getApplicationContext(), getResources().getString(R.string.toast_error_permissions_missing), Toast.LENGTH_LONG);                    toast.show();                }            }        });        final Button btn_login_example_table = findViewById(R.id.ExampleTableLoginButton);        btn_login_example_table.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                tableManager.getExampleTable(new TableFirestoreManager.GetExampleTableCallback(){                    @Override                    public void onCallback(Table table) {                        SharedPreferencesAdapter.setDefaults("currentTable", table.getTableId(), getBaseContext());                        Intent intent = new Intent(MainActivity.this, MenuActivity.class);                        startActivityForResult(intent, REQUEST_CODE);                    }                    @Override                    public void onFailureCallback(Exception e) {                        Toast toast = Toast.makeText(getApplicationContext(), getResources().getString(R.string.toast_error_no_example_table_found), Toast.LENGTH_LONG);                        toast.show();                    }                });            }        });        final Button button = findViewById(R.id.registerButton);        button.setOnClickListener(new View.OnClickListener() {            public void onClick(View v) {                Intent intent = new Intent(v.getContext(), RegistrationActivity.class);                v.getContext().startActivity(intent);            }        });        final Button loginButton = findViewById(R.id.loginButton);        loginButton.setOnClickListener(new View.OnClickListener() {            public void onClick(View v) {                Intent intent = new Intent(v.getContext(), LoginActivity.class);                v.getContext().startActivity(intent);            }        });    }    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data) {        IntentResult result = IntentIntegrator.parseActivityResult(requestCode, resultCode, data);        if(result != null) {            if(result.getContents() != null) {                String scannedTableID = result.getContents();                // check if result.getContents() is a valid tableID                tableManager.getTableById(scannedTableID, new TableFirestoreManager.GetTableByIdCallback() {                    @Override                    public void onCallback(final Table table) {                        SharedPreferencesAdapter.setDefaults("currentTable", scannedTableID, getBaseContext());                        Intent intent = new Intent(MainActivity.this, MenuActivity.class);                        startActivityForResult(intent, REQUEST_CODE);                    }                    @Override                    public void onFailureCallback(Exception e) {                        Toast toast = Toast.makeText(getApplicationContext(), getResources().getString(R.string.toast_error_no_valid_qrcode), Toast.LENGTH_LONG);                        toast.show();                    }                });            }        } else {            // This is important, otherwise the result will not be passed to the fragment            super.onActivityResult(requestCode, resultCode, data);        }    }    private void requestPermission(String permissionName, int permissionRequestCode) {        ActivityCompat.requestPermissions(this,                new String[]{permissionName}, permissionRequestCode);    }}